<html>
  <head>
    <meta
      name="viewport"
      content="width=device-width,height=device-height,initial-scale=1.0"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/4.0.2/bootstrap-material-design.css"
    />

    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <link rel="stylesheet" href="./newstyle.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.4/fetch.min.js"
      integrity="sha512-IsoGB9P1Kjw962zrslxT91OfoKkAnlBfQDdh5HwFvOxwJ8xGV6MuDeAli4TkEMiUqhJVkvpxJBsIS14bSERgxA=="
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"></script>
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/4.0.0/mustache.min.js"
      integrity="sha512-ZtynsaJmQRo6Ru0RHAPHnMfmTCLSTRcAoxbl5csw47H9EbEZWpns3URyVNgAvj6KQvEM6ysjTQZ3jj61go0NsQ=="
      crossorigin="anonymous"
    ></script>
    <script src="./script.js"></script>
  </head>

  <body>
    <div class="chat-box" style="display: block">
      <div class="chat-box-header">
        <div class="bg">
          <div class="first-column">

            <img
              tabindex="0"
              class="disha-logo"
              src="./botlogo.gif "
              alt="Ask Disha Avatar"
            />
            <div
              tabindex="0"
              aria-label="Ask Disha 2.0 Heading Title"
              class="header-text"
            >
	    <!--  <p>Tiger</p>-->
              <h3>IT_Bot</h3>
              <span>1.0</span>
            </div>

          </div>

          <div tabindex="0" title="Tiger Analytics" class="second-column">
           
         <!--   <div class="logo-container">
             <img
                src="./logo.png"
                alt=""
                width="50px"
		/>
	 </div>-->
	    <br/>
	                <div class="buttons">
				<!--				<span class="chat-box-toggle"><i class="material-icons" id="reload"> home</i></span><br/>-->
				      <span class="chat-box-toggle"><i class="material-icons" id="reload">home</i></span>

<!-- <span class="chat-box-toggle" id="chat-box-minimize" title="Minimize Chat"><i class="material-icons"  id="close">cancel</i></span>-->

     <!--        <img
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzklEQVR4nO2WYQrCMAyFdwlF73+c7pf94T1SITZEIgUFnXNLs4yC7kFhUB5fk61v6bpNf6kkskfivqzybPZnDmo/iOyQ+HSlm5SFxOeLyFELNfuRuH+aXsxRc/JHpfHDnzmYwBr4N6gaDINWDeCjbVN4DrPgWrgbtAbuDlW9N+I4tWe5hm+aqsq9UivcFaqFrwKtAKsTbo1W+8DB9nEtg6cW1wkU4WCJ10nVJJIbHAwx6ALHVr9FbDUIwPjook6kRf5UTp45VA1rjv5Nv6E72tqCxjPrsGgAAAAASUVORK5CYII="
                class="btn-menu"
                tabindex="0"
		/>
		<br/>
              <img
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6UlEQVR4nO3TMWoCURAG4GcKSRtILTYpQ4p4Bbucws5beIXcIV0OIRhSprUxlUisTcCZ+XcevyiuJrqyuruQQgcGXjF8P28eL4SzqfmcDYF/LHt5rhQ3473Cx4rIVZt/AXysBJckaYv5bIOvW8x/NEmeyuHmHTHHLv4rxAXePRkmWROLvUPwflB8Jnl1LF4XxJdjcU1DEF9JXufhN2rePxXX7eO/f5O32fsWNgU+LIwjbR+p8u4PbsYHhU/K4zG9yRRgaxOg8M/KcGxvkrmqsnDIq38LCAXnLgE8xxWZv2X8zEHRuUuFvFoAq8zan1XdQl0AAAAASUVORK5CYII="
                class="btn-reset"
                tabindex="0"
		/>-->
            </div>
          </div>
        </div>
        <!-- <span class="chat-box-toggle"><i class="material-icons">close</i></span> -->
      </div>
      <div class="chat-box-body">
        <div class="chat-box-overlay"></div>
        <div class="chat-logs"></div>
        <!--chat-log -->
      </div>
      <!-- <div class="ticontainer">
            <div class="tiblock">
              <div class="tidot"></div>
              <div class="tidot"></div>
              <div class="tidot"></div>
            </div>
          </div> -->
      <div class="chat-input">
        <audio id="response_audio_id" controls style="display: none">
          <source id="response_audio_source_id" src="" type="audio/mp3" />
        </audio>

        <form>
          <input type="text" id="chat-input" placeholder="Type a message..." />
          <button type="submit" class="chat-submit" id="chat-submit">
            <i class="material-icons" style="margin-top: 18px;color: #ffffff;">send</i>
          </button>
        </form>
      </div>
    </div>
    <script id="template_typing" type="x-tmpl-mustache">
      <div class="loading">typing </div>
    </script>
    <script id="template_text" type="x-tmpl-mustache">
      <span id="text_input">
                      {{{text}}} </span>
    </script>
    <script id="template_intent" type="x-tmpl-mustache">
      <span id="text_intent">
                    Confidence  {{{intent}}} </span>
    </script>
    <script id="template_quick_reply_replies" type="x-tmpl-mustache">
      <span id="quick_replies" class="quick_replies_class" onclick="window.__bot.process_input('{{reply_slug}}','{{reply_display_text}}')">{{ reply_display_text }}</br></span>
    </script>
    <script id="template_quick_reply" type="x-tmpl-mustache">
      <div style="line-height: 40px;" class="replies_container_div">
                  {{{rendered_replies}}} </div>
    </script>
    <script id="template_links" type="x-tmpl-mustache">
      <br/> <a href="{{link.url}}" target="_blank" style="color: var(--main-bg-color);font-style: italic;">{{reply_display_text}} </a>
    </script>
    <script id="template_chat" type="x-tmpl-mustache">
      <div id="cm-msg-{{INDEX}}" class="chat-msg {{type}}">
                  <span class="msg-avatar"  style={{{style}}}>
                      {{{profile_image}}} </span>
                  <div class={{{class_name}}}>
                      {{{msg}}} </div>
              </div>
    </script>
    <script id="voice_recognizing" type="x-tmpl-mustache">
      <div class="loading"><br/>Recognizing</div>
    </script>
    <script id="template_form_container" type="x-tmpl-mustache">
      <span id="text_input">
                  {{{ form }}} </span>
    </script>
    <script id="template_form" type="x-tmpl-mustache">
      <form class="chat_form" id="{{ name }}" onkeydown="return event.key != 'Enter';">
                  {{{ fields }}}
                  <div class="invalid-feedback text-center d-block" id="error_message_{{ name }}_server"></div>
                  <button type="button" class="btn chat_form_button" onclick="window.__bot.chat_form_action('{{ name }}', 'submit')">Send</button>
                  <button type="button" class="btn chat_form_button" onclick="window.__bot.chat_form_action('{{ name }}', 'cancel')">Cancel</button>
              </form>
    </script>
    <script id="template_form_field_text" type="x-tmpl-mustache">
      <div class="form-group">
          <label for="{{ field.name }}" class="bmd-label-floating" style="font-size: 15 !important; color:#f0ad4e;">{{field.display_name}}</label>
          <input type="text" class="form-control" name="{{ field.name }}" value="{{field.value}}" {{ field.required }}>
              <div class="invalid-feedback" id="error_message_{{ form_name }}_{{ field.name }}"></div>
          </div>
    </script>
    <script id="template_form_field_email" type="x-tmpl-mustache">
      <div class="form-group">
          <label for="{{ field.name }}" class="bmd-label-floating" style="font-size: 15 !important;color:#f0ad4e;">{{field.display_name}}</label>
          <input type="email" class="form-control" name="{{ field.name }}" {{ field.required }}>
              <div class="invalid-feedback" id="error_message_{{ form_name }}_{{ field.name }}"></div>
          </div>
    </script>
    <script id="template_form_field_textarea" type="x-tmpl-mustache">
      <div class="form-group">
          <label for="{{ field.name }}" class="bmd-label-floating" style="font-size: 15 !important;color:#f0ad4e;">{{field.display_name}}</label>
          <textarea rows="{{ field.rows }}" class="form-control" name="{{ field.name }}" {{ field.required }}></textarea>
      </div>
    </script>
    <script id="template_form_field_password" type="x-tmpl-mustache">
      <div class="form-group">
          <label for="{{ field.name }}" class="bmd-label-floating" style="font-size: 15 !important;color:#f0ad4e;">{{field.display_name}}</label>
          <input type="text" class="form-control field_password" name="{{ field.name }}" {{ field.required }} autocomplete="off">
              <div class="invalid-feedback" id="error_message_{{ form_name }}_{{ field.name }}"></div>
          </div>
    </script>
    <script id="template_form_field_select" type="x-tmpl-mustache">
      <div class="form-group">
              <label for="{{ field.name }}" class="bmd-label-floating" style="font-size: 15 !important;color:#f0ad4e;">{{field.display_name}}</label>
              <select class="form-control" name="{{ field.name }}" {{ field.required }}>
                  {{{ options }}} </select>
          </div>
    </script>
    <script id="template_form_field_select_option" type="x-tmpl-mustache">
      <option value="{{ option.value }}">{{option.display_value}} </option>
    </script>
    <script id="template_form_field_file_pdf" type="x-tmpl-mustache">
      <div class="form-group">
          <button class="btn" id="button_form_file" onclick="window.__bot.chat_form_upload_form_file()" type="button">Choose File</button>
          <input type="file" class="form-control" name="{{ field.name }}" id="{{ form_name }}_form_file" accept="application/pdf" {{ field.required }} style="float: right;">
          <div class="invalid-feedback" id="error_message_{{ form_name }}_{{ field.name }}" style="float: left;"></div>
      </div>
      <br>
      <br>
    </script>
    <script id="template_form_field_calendar" type="x-tmpl-mustache">
      <div class="form-group">
          <label for="{{ field.name }}" class="bmd-label-floating" style="font-size: 15 !important; color:#f0ad4e;">Date</label>
          <input type="date" class="form-control" name="{{ field.name }}" {{ field.required }}>
              <div class="invalid-feedback" id="error_message_{{ form_name }}_{{ field.name }}"></div>
          </div>
    </script>

    <script id="template_star_rating" type="x-tmpl-mustache">
      <div class="rate">
          <input type="radio" id="star5" name="rate" value="5" onclick="window.__bot.radioClick(5)" />
          <label for="star5" title="Great" >5 stars</label>
          <input type="radio" id="star4" name="rate" value="4" onclick="window.__bot.radioClick(4)" />
          <label for="star4" title="Good">4 stars</label>
          <input type="radio" id="star3" name="rate" value="3" onclick="window.__bot.radioClick(3)" />
          <label for="star3" title="Average">3 stars</label>
          <input type="radio" id="star2" name="rate" value="2" onclick="window.__bot.radioClick(2)" />
          <label for="star2" title="Below average">2 stars</label>
          <input type="radio" id="star1" name="rate" value="1" onclick="window.__bot.radioClick(1)" />
          <label for="star1" title="Unsatisfactory">1 star</label>
      </div>
    </script>

    <script>
      $(document).ready(function () {
        window.__bot = chatbot();
        window.__bot.show_typing_indicator();
        window.__bot.userVerification();
        window.__bot.INDEX = 0;
	$("#reload").click(function(){
           $(".chat-logs").children().remove();
            window.__bot.userVerification();

        });
		  
        $("#chat-submit").click(function (e) {
          console.log("message submitted");
          e.preventDefault();
          var msg = $("#chat-input").val();
          if (msg.trim() == "" || window.__bot.awaiting_response) {
            return false;
          }
          window.__bot.process_input(msg, undefined);
        });
        $(document).delegate(".chat-btn", "click", function () {
          var value = $(this).attr("chat-value");
          var name = $(this).html();
          $("#chat-input").attr("disabled", false);
          window.__bot.generate_message(name, "self");
        });

        window.__bot.chat_form_hide = function (element_form_jquery) {
          if (element_form_jquery) {
            element_form_jquery.closest(".chat-msg").remove();
          } else {
            $(".chat_form").closest(".chat-msg").remove();
          }
        };

        window.__bot.chat_form_upload_form_file = function () {
          console.log("file upload clicked");
          $("#file_upload_form_file").trigger("click");
        };

        window.__bot.chat_form_action = function (form_name, action) {
          var element_form = document.getElementById(form_name);
          var element_form_jquery = $("#" + form_name);
          if (element_form) {
            document.getElementById(
              "error_message_" + form_name + "_server"
            ).innerHTML = "";
            if (action == "cancel") {
              window.__bot.chat_form_hide(element_form_jquery);
              return;
            } else if (action == "submit") {
              for (var i = 0; i < element_form.elements.length; i++) {
                var element = element_form.elements[i];
                console.log("element11", element, element.name);
                if (element.name == "form_file") {
                  var file = element.files[0];
                  if (!file || file.type != "application/pdf") {
                    document.getElementById(
                      "error_message_" + form_name + "_" + element.name
                    ).innerHTML = "Please upload a valid PDF file.";
                    document
                      .getElementById(form_name + "_" + element.name)
                      .classList.add("is-invalid");
                    return;
                  } else {
                    document.getElementById(
                      "error_message_" + form_name + "_" + element.name
                    ).innerHTML = "";
                    document
                      .getElementById(form_name + "_" + element.name)
                      .classList.remove("is-invalid");
                  }
                } else if (element.required && !element.value.trim()) {
                  document.getElementById(
                    "error_message_" + form_name + "_" + element.name
                  ).innerHTML =
                    "Please enter " +
                    element.previousElementSibling.innerHTML.trim() +
                    ".";
                  element.classList.add("is-invalid");
                } else if (
                  element.type == "email" &&
                  !element.checkValidity()
                ) {
                  document.getElementById(
                    "error_message_" + form_name + "_" + element.name
                  ).innerHTML =
                    "Please enter a valid " +
                    element.previousElementSibling.innerHTML.trim() +
                    ".";
                  element.classList.add("is-invalid");
                } else {
                  element.classList.remove("is-invalid");
                }
              }
              if (!element_form.checkValidity()) {
                return;
              }
            }
          }
          var form_data = {};

          $(".chat_form_button").attr("disabled", true);
          element_form_jquery.serializeArray().map(function (x) {
            form_data[x.name] = x.value;
          });
          if (form_name == "ticketUpdate_form") {
            let i = 0;
            for (i = 0; i <= 4; i++) {
              form_data[element_form_jquery[0].elements[i].name] =
                element_form_jquery[0].elements[i].value;
            }
          }
          console.log(form_data);
          var data = {};
          data.web_uid = window.__bot.web_uid;
          data.form_data = form_data;
          data.form_name = form_name;
          (data.web_user = window.__bot.web_user),
            (data.web_session = window.__bot.session_id
              ? window.__bot.session_id
              : ""),
            (data.user_verified = window.__bot.user_verified),
            (data.user_email = window.__bot.user_email
              ? window.__bot.user_email
              : "");
          var request_body = JSON.stringify(data);
          var request_headers = {
            "Content-Type": "application/json",
          };
          window.__bot.disable_reset_chat();
          window.__bot.awaiting_response = true;
          if (form_name == "add_calendar") {
            selected_date = "selected date is " + form_data.calendar_text;
            window.__bot.process_input(selected_date, undefined);
          } else {
            fetch(
              window.__bot.server_host_http +
                window.__bot.url_prefix +
                "submit_form",
              {
                method: "POST",
                headers: request_headers,
                body: request_body,
              }
            )
              .then(function (response) {
                console.log(response);
                return response.json();
              })
              .then(function (response_data) {
                console.log(response_data);
                if (response_data.error_msg) {
                  document.getElementById(
                    "error_message_" + form_name + "_server"
                  ).innerHTML = response_data.error_msg;
                  $(".chat_form_button").attr("disabled", false);
                } else {
                  window.__bot.chat_form_hide(element_form_jquery);
                  window.__bot.process_messages(
                    response_data.data.response_messages,
                    0
                  );
                }
                window.__bot.enable_reset_chat();
                window.__bot.awaiting_response = false;
              });
          }
        };
        // init
      });
    </script>
  </body>
</html>

